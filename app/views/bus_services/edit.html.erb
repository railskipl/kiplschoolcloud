<%-# Fedena
#Copyright 2010 Foradian Technologies Private Limited
#
#This product includes software developed at
#Project Fedena - http://www.projectfedena.org/
#
#Licensed under the Apache License, Version 2.0 (the "License");
#you may not use this file except in compliance with the License.
#You may obtain a copy of the License at
#
#  http://www.apache.org/licenses/LICENSE-2.0
#
#Unless required by applicable law or agreed to in writing,
#software distributed under the License is distributed on an
#"AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
#KIND, either express or implied.  See the License for the
#specific language governing permissions and limitations
#under the License. -%>
<%= javascript_include_tag 'jquery/jquery.min.js' %>
<%= javascript_include_tag "fancybox.js" %>
<%= stylesheet_link_tag "fancybox.css" %>

<div id="masthead">
		
		<div class="content_pad">
			<div id="content-header">
			   <%= image_tag("/images/bus_service/bus.png") %>
  				<h1><%= t('bus_service') %></h1>
 				 <h3><%= @bus_service.bus_name %></h3>
			  <div id="app-back-button">
			    <%= link_to_function image_tag("/images/buttons/back.png",:border => 0), "history.back()" %>
			  </div>
			</div>	
		</div> <!-- .content_pad -->
		
	</div> <!-- #masthead -->	
	
	<div id="content" class="xgrid">


<div id="page-yield">

  <% unless flash[:notice].nil? %>
    <p class="flash-msg"> <%= flash[:notice] %> </p>
  <% end %>

  <div class="box">
    <div class="bread_crumb">
      <%= link_to "#{t('bus_service')}", bus_services_path %> &raquo;
      <%= @bus_service.bus_name %>
    </div>

    <% form_for(@bus_service) do |f| %>

      <%= error_messages_for :bus_service %>

      <div class="label-field-pair">
        <div class="label-container1"><%= t("bus_service_text.name") %><span class="red" style="color:red"> * </span></div>
        <div class="input-container"><%= f.text_field :bus_name %></div>
      </div>

      <div class="label-field-pair">
        <div class="label-container1"><%= t("bus_service_text.bus_number") %><span class="red" style="color:red"> * </span></div>
        <div class="input-container"><%= f.text_field :bus_no %></div>
      </div>

      <div class="label-field-pair">
        <div class="label-container1"><%= t("bus_service_text.driver_name") %></div>
        <div class="input-container"><%= f.text_field :driver_name %></div>
      </div>

      <div class="label-field-pair">
        <div class="label-container1"><%= t("bus_service_text.conductor_name") %></div>
        <div class="input-container"><%= f.text_field :conduct_name %></div>
      </div>

      <div class="label-field-pair">
        <div class="label-container1"><%= t("bus_service_text.contact_number") %> </div>
        <div class="input-container"> <%= f.text_field :contact_number %> </div>
      </div>  
      
      <div class="label-field-pair">
        <div class="label-container1"> <%= t("bus_service_text.no_of_seats") %><span class="red" style="color:red"> * </span> </div>
        <div class="input-container"> <%= f.text_field :no_of_seats %> </div>
      </div>  
      <div class="label-field-pair">
        <div class="label-container1"> <%= t("bus_service_text.gps_unit_no") %><span class="red" style="color:red"> * </span> </div>
        <div class="input-container"> <%= f.text_field :gps_unit_no %> </div>
      </div>
      <div class="label-field-pair">
        <div class="label-container1"> <%= t("bus_service_text.gprs_sim_no") %><span class="red" style="color:red"> * </span> </div>
        <div class="input-container"> <%= f.text_field :gprs_sim_no %> </div>
      </div>
      
      <div style="float:left; width:600px">
      <div class="label-container1">
        <label class="status" for="status"><%= t('status') %></label>
        </div>
        <div id="radio-buttons">
            <%= f.radio_button  "status", "true", :checked => "checked" %>
            <label class="label_for_status" for="bus_service_status_true"><%= t('active') %></label>
            <%= f.radio_button  "status", "false" %>
          <label class="label_for_status" for="bus_service_status_false"><%= t('inactive') %></label>
          </div>
          
      </div>
     
        
      <div class="label-field-pair">
        <label for="label-container1"><%= "#{t('bus_service_text.reader_id')}" %></label>
        <div class="text-input-bg"><%= select :bus_service, :reader_id, Reader.find(:all, :order => 'id ASC').map {|b| [b.reader_name, b.id]}, :prompt => "#{t('select_rfid')}" %></div>
      </div>

      <div class="label-field-pair" style= "clear:left" >
        <div class="label-container1">  <%= t("route") %></div>
        <div class="text-container">
          <%= link_to "#{t('click_here')}",'#route',:class => 'fancybox' %>
        </div>  
      </div>
       
      <div class="label-field-pair">
        <div class="label-container1"><%= t("select_student") %></div>
        <div class="text-container">
          <%= link_to "#{t('click_here')}",'#user',:class => 'fancybox' %>
        </div>
      </div>  
      <div class="label-field-pair">
        <div class="label-container1"><%= t("bus_service_text.bus_allocated_number") %><span class="red" style="color:red"> * </span></div>
        <div class="input-container"><%= f.text_field :bus_allocated_no %></div>
      </div>

      <div class="label-field-pair">
        <div class="label-container1"><%= t("bus_service_text.starting_point") %><span class="red" style="color:red"> * </span></div>
        <div class="input-container"><%= f.text_field :bus_start_point %></div>
      </div>

      <div class="label-field-pair">
        <div class="label-container1"><%= t("bus_service_text.end_point") %><span class="red" style="color:red"> * </span></div>
        <div class="input-container"><%= f.text_field :bus_end_point %></div>
      </div>

      <%= submit_tag "", :value => "â–º #{t('save')}", :class => "submit_button" %>
        <!-- Routes Allocation for bus services -->
        <div id="route" style="display:none;" class="inline">
          <div id="modalHeader" style="background:none;border-bottom:1px solid #ccc;height:33px;">
            <h4 style="margin:3px;text-align:center;"> <%= t("bus_service_text.bus_route") %> </h4>
          </div>
           <div id="modalBody" style="margin-top:5px;">
              <table style="width:100%;height:100%;">
                <% @routes.in_groups_of(5,false).each do |bus_routes| %>
                <tr> 
                  <% bus_routes.each do |bus_route| %>
                    <td>
                      <div> 
                        <%= check_box_tag "bus_service[route_ids][]",bus_route.id,@bus_service.routes.include?(bus_route) %> 
                          <span class='user_name' title="<%= bus_route.name %>"> 
                            <%= bus_route.name %> 
                          </span>
                      </div>  
                    </td> 
                  <%end%>
                </tr>
                <%end%>
              </table>    
           </div>
        </div>
       <!-- User Allocation for the Bus Service -->
        <div id="user" style="display:none;" class="inline">
          <div id="modalHeader" style="background:none;border-bottom:1px solid #ccc;height:33px;">
            <h4 style="margin:3px;text-align:center;" >  <%= t("bus_service_text.allocate_user") %> </h4>
          </div>

          <div id="modalBody" style="margin-top:5px;">
              <table style="width:100%;height:100%;">
                <% @students.in_groups_of(5,false).each do |students| %>
         
                  <tr> 
                   <% students.each do |student| %>
                    <td>
                      <div>
                      <%= check_box_tag "bus_service[student_ids][]",student.id,@bus_service.students.include?(student) %> 
                       <span class='user_name' title="<%= student.full_name %>"> 
                        <%= student.first_name %> 
                       </span>
                      </div> 
                    </td>
                   <%end%>
                  </tr>
                
                <%end%>
              </table>
          </div>
        </div>
    <% end %>
    <div class="extender"></div>
  </div>
</div>
</div>
  

<script type="text/javascript">
  (function($){
    $(document).ready(function() {
      $('.fancybox').fancybox({
          maxWidth : 600,
          maxHeight : 300,
          height: 500,
          fitToView : false,
          autoSize  : false,
          closeClick  : false,
          openEffect  : 'none',
          closeEffect : 'none'
        })
    })
  })(jQuery)
</script>